#!/bin/bash --login
# --------------------------------------------------------------------------- #
#                                                                             #
# nwps_rips_dev.cron : This script manages the running of the parallel script #
#                      nwps_plot_runup_6day.py                                #
#                                                                             #
# Remarks   - Set the WFOs to process in ${NWPSdir}/parm/wfo_prod.tbl          #
#                                                                             #
# Last Changed : 06-14-2022                                        June 2022  #
# --------------------------------------------------------------------------- #

# Set up the modules

#. /usrx/local/Modules/3.2.9/init/bash
module load prod_envir
module load prod_util
#module load ics
#module load ibmpe
#module load lsf
module load alps
module load xt-lsfhpc

module list

# 0.a Set necessary variables
export workdir=${VALIDATIONdir}'/validation_prod/'
echo 'Running in '${workdir}

# 0.b Host assessment

export script='nwps_rips_prod.cron'
export runon='BACKUPSYS'

  echo '                  ***********************************************'
  echo '                  *** NWPS HOOK-IN SCRIPT nwps_rips_prod.cron ***'
  echo '                  ***********************************************'
  echo ' '
  echo " Time : `date`"
  echo ' '
  echo '        Host assessment :'
  echo '        ------------------------------------------------------------'
  echo "           script to run      : $script"
  echo "           running on         : $runon"

  export host_s="`cat /etc/HOSTNAME | cut -c1-1`"
  case $host_s in
   'c' ) host='cactus' ;;
   'd' ) host='dogwood' ;;
    *  ) echo ' '
         echo ' *****************************'
         echo " *** HOST $host_s NOT RECOGNIZED ***"
         echo ' *****************************'
         echo ' '
         date=`date -u +"%Y%m%d t%Hz"`
         echo "nwps.cron $date : host [$host] not recognized." >> $weblog
         exit 1 ;;
  esac

  echo ' '
  echo "           host machine       : $host"

  #prod=`cat /etc/prod | awk '{ print $1 }'`
  sec_profile=`cat /etc/wcoss.conf | grep sec_profile | cut -d ':' -f 2`
  echo "           machine function   : $sec_profile"

  #if [ "$runon" = 'none' ]
  #then
  #  target='none'
  #else
  #  target=`cat /etc/$runon | awk '{ print $1 }'`
  #fi
  #echo "           running on         : $runon [$target]"

  if [ "$sec_profile" != "$runon" ]
  then
    echo ' '
    echo " Time : `date`"
    echo ' '
    echo ' '
    echo '                        *** End of nwps.cron ***'
    exit 0
  fi

  #check_queue="$(bqueues | grep -E 'dev |dev_shared|devmax|devhigh' | grep Open)"
  check_queue="$(qstat -q | grep -E 'dev |dev_shared|devmax|devhigh')"
  if [ "$check_queue" == "" ]
  then
    echo ' '
    echo " Time : `date`"
    echo ' '
    echo " nwps.cron $date : Dev run queues are closed. Exiting..."
    echo ' '
    echo '                        *** End of nwps.cron ***'
    exit 0
  fi

# --------------------------------------------------------------------------- #
# 1.  Manage batch job

  echo " "
  echo "        -> Submitting nwps_rips_prod.lsf at: `date`"

  region='sr'
  wfo='bro'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='crp'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='hgx'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='lch'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='lix'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='mob'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='tae'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='tbw'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='key'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='mfl'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='sju'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='mlb'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='jax'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}

  region='er'
  wfo='chs'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='ilm'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='mhx'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='akq'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='phi'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='okx'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='box'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='gyx'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='car'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
 
  region='wr'
  wfo='sgx'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='lox'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='mtr'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='eka'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='mfr'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='pqr'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  #wfo='sew'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}

  region='pr'
  wfo='hfo'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}
  wfo='gum'; sed -e "s/%REGION%/$region/g" -e "s/%WFO%/$wfo/g" ${workdir}/nwps_rips_wfo_prod.lsf.tmpl > ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}; qsub ${workdir}/nwps_rips_wfo_prod.lsf.${wfo}

  echo " "

# --------------------------------------------------------------------------- #
# 2.  End of all.

  echo ' '
  echo ' '
  echo " Time : `date`"
  echo ' '
  echo '                        *** End of nwps_rips_prod.cron ***'

# - end of nwps_rips_prod.cron ----------------------------------------------- #
